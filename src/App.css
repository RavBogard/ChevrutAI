/* Global Vars & Reset fixes */
:root {
  --primary-color: #3b82f6;
  /* Modern Blue */
  --accent-color: #6366f1;
  /* Indigo */
  --sidebar-bg: #111827;
  /* Dark Slate */
  --sidebar-text: #f3f4f6;
  --sheet-bg: #ffffff;
  --sheet-text: #1f2937;
  --message-user-bg: #3b82f6;
  --message-bot-bg: #1f2937;
  --border-color: #374151;

  --font-ui: 'Inter', system-ui, sans-serif;
  /* Classic Hebrew feel */
  --font-english-serif: 'Merriweather', serif;

  --source-bg: #ffffff;
  --input-bg: #f9fafb;
}

body.dark-mode {
  --sheet-bg: #111827;
  /* Gray 900 */
  --sheet-text: #f3f4f6;
  /* Gray 100 */
  --source-bg: #1f293b;
  /* Gray 800-ish */
  --border-color: #374151;
  --input-bg: #374151;
}

body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  /* App container handles scroll */
  font-family: var(--font-ui);
  transition: background-color 0.3s, color 0.3s;
}

.app-container {
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: var(--sidebar-bg);
  /* Fallback */
  color: var(--sheet-text);
  overflow: hidden;
}

/* Chat Sidebar */
.chat-sidebar {
  width: 30%;
  min-width: 320px;
  max-width: 450px;
  background-color: var(--sidebar-bg);
  color: var(--sidebar-text);
  display: flex;
  flex-direction: column;
  border-right: 1px solid var(--border-color);
  box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
  z-index: 10;
}

.chat-header {
  padding: 1.5rem;
  border-bottom: 1px solid var(--border-color);
  background: rgba(17, 24, 39, 0.95);
  backdrop-filter: blur(10px);
}

.chat-header h2 {
  margin: 0;
  font-size: 1.25rem;
  background: linear-gradient(90deg, #60a5fa, #a78bfa);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}

.status-indicator {
  font-size: 0.75rem;
  color: #10b981;
  display: block;
  margin-top: 0.25rem;
}

.messages-list {
  flex: 1;
  overflow-y: auto;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.message {
  max-width: 85%;
  padding: 0.8em 1em;
  border-radius: 12px;
  font-size: 0.95rem;
  line-height: 1.5;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.message.user {
  align-self: flex-end;
  background-color: var(--message-user-bg);
  color: white;
  border-bottom-right-radius: 2px;
}

.message.model {
  align-self: flex-start;
  background-color: var(--message-bot-bg);
  color: #e5e7eb;
  border-bottom-left-radius: 2px;
  border: 1px solid var(--border-color);
}

.suggested-sources {
  margin-top: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
}

.source-suggestion-card {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--border-color);
  padding: 0.8rem;
  border-radius: 8px;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  transition: transform 0.2s;
}

.source-suggestion-card:hover {
  transform: translateY(-2px);
  background: rgba(255, 255, 255, 0.08);
}

.source-info strong {
  display: block;
  color: #60a5fa;
  margin-bottom: 0.2rem;
}

.source-summary {
  font-size: 0.85rem;
  color: #9ca3af;
}

.add-source-btn {
  align-self: flex-start;
  background-color: rgba(16, 185, 129, 0.2);
  color: #34d399;
  border: 1px solid rgba(16, 185, 129, 0.4);
  padding: 0.4rem 0.8rem;
  border-radius: 4px;
  font-size: 0.8rem;
  cursor: pointer;
  margin-top: 0.5rem;
}

.add-source-btn:hover {
  background-color: rgba(16, 185, 129, 0.3);
}

.chat-input-form {
  padding: 1rem;
  border-top: 1px solid var(--border-color);
  display: flex;
  gap: 0.5rem;
  background-color: var(--sidebar-bg);
}

.chat-input-form input {
  flex: 1;
  padding: 0.8rem;
  border-radius: 8px;
  border: 1px solid var(--border-color);
  background-color: #374151;
  color: white;
  outline: none;
}

.chat-input-form input:focus {
  border-color: var(--primary-color);
}

.chat-input-form button {
  padding: 0 1.2rem;
  background-color: var(--primary-color);
  color: white;
  border: none;
  font-weight: 600;
}

.loading .typing-dot {
  display: inline-block;
  width: 6px;
  height: 6px;
  margin-right: 3px;
  border-radius: 50%;
  background-color: #9ca3af;
  animation: typing 1.4s infinite ease-in-out both;
}

.typing-dot:nth-child(1) {
  animation-delay: -0.32s;
}

.typing-dot:nth-child(2) {
  animation-delay: -0.16s;
}

@keyframes typing {

  0%,
  80%,
  100% {
    transform: scale(0);
  }

  40% {
    transform: scale(1);
  }
}

/* Sheet View */
.sheet-view {
  flex: 1;
  background-color: var(--sheet-bg);
  color: var(--sheet-text);
  overflow-y: auto;
  padding: 2rem 4rem;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.sheet-header {
  text-align: center;
  margin-bottom: 3rem;
  border-bottom: 2px solid #e5e7eb;
  padding-bottom: 1rem;
  width: 100%;
  max-width: 900px;
}

.sheet-header h1 {
  font-family: var(--font-english-serif);
  font-size: 2.5rem;
  color: #111827;
  margin: 0;
}

.sheet-meta {
  color: #6b7280;
  font-style: italic;
  margin-top: 0.5rem;
}

.sheet-paper {
  width: 100%;
  max-width: 900px;
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.empty-state {
  text-align: center;
  color: #9ca3af;
  margin-top: 4rem;
  font-size: 1.1rem;
}

/* Source Block */
.source-block {
  background: var(--source-bg);
  color: var(--sheet-text);
  /* subtle visual separation if background is not white, but here bg is white. 
     Let's add a left border or subtle shadow for block distinction */
  border-left: 4px solid var(--primary-color);
  padding: 1rem 1.5rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
  border-radius: 0 8px 8px 0;
  transition: all 0.2s;
}

.source-block:hover {
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

.source-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  border-bottom: 1px solid #f3f4f6;
  padding-bottom: 0.5rem;
}

.source-header h3 {
  margin: 0;
  font-family: var(--font-english-serif);
  color: var(--primary-color);
  font-size: 1.2rem;
}

.source-controls {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

.view-toggle {
  padding: 0.3rem;
  border-radius: 4px;
  border: 1px solid var(--border-color);
  font-size: 0.8rem;
  color: var(--sheet-text);
  background-color: var(--source-bg);
}

.remove-btn {
  background: transparent;
  color: #9ca3af;
  border: none;
  font-size: 1.2rem;
  line-height: 1;
  padding: 0 0.4rem;
}

.remove-btn:hover {
  color: #ef4444;
  background: transparent;
}

.source-content {
  display: flex;
  gap: 2rem;
  font-size: 1.1rem;
  line-height: 1.6;
}

.text-eng,
.text-heb {
  flex: 1;
}

.text-eng {
  font-family: var(--font-english-serif);
}

.text-heb {
  font-family: var(--font-hebrew);
  text-align: right;
  font-size: 1.3rem;
  /* Hebrew often needs to be slightly larger */
}

/* View Modes */
.view-english .text-heb {
  display: none;
}

.view-hebrew .text-eng {
  display: none;
}

/* Responsive */
/* Mobile Layout (<768px) */
@media (max-width: 768px) {
  .app-container {
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
  }

  /* Sheet View takes full screen */
  .sheet-view {
    height: 100%;
    width: 100%;
    padding: 1rem;
    overflow-y: auto;
    padding-bottom: 80px;
    /* Space for FAB */
  }

  /* Compact Logo Header for Mobile (Optional: If you want a header on the sheet view on mobile)
     Currently the sidebar is hidden, so we might want a small logo on the SheetView or just rely on the Chat header when opened.
     The user requirement says "Compact header with small logo". 
     Since the sidebar is now hidden, the logo is hidden too. 
     We should probably ensure the Sheet View has some branding or the sidebar header acts as a persistent top bar?
     
     The user said: "Compact header with small logo + hamburger menu" (or similar).
     However, the chat IS the sidebar.
     
     Let's implement the Bottom Sheet Chat approach logic.
  */

  /* Hide sidebar by default on mobile */
  .chat-sidebar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 85vh;
    /* Cover most of height */
    max-height: 85vh;
    background-color: var(--sidebar-bg);
    z-index: 100;
    border-radius: 20px 20px 0 0;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.4);
    transform: translateY(110%);
    /* Hidden */
    transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    border-right: none;
    display: flex;
    /* Override previous styles if needed */
  }

  .chat-sidebar.mobile-open {
    transform: translateY(0);
  }

  /* Chat Header Mobile Adjustments */
  .chat-header {
    padding: 1rem;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }

  .header-top-row {
    display: flex;
    width: 100%;
    justify-content: space-between;
    align-items: center;
  }

  /* Reduce Logo Size significantly */
  .sidebar-logo {
    max-height: 40px !important;
    /* Force small size */
    width: auto;
    margin-bottom: 0;
  }

  /* Mobile Close Button */
  .mobile-close-btn {
    display: block;
    background: none;
    border: none;
    color: #9ca3af;
    font-size: 2rem;
    cursor: pointer;
    padding: 0 0.5rem;
  }

  .mobile-chat-fab {
    display: flex;
    align-items: center;
    justify-content: center;
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background-color: var(--primary-color);
    color: white;
    border: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    z-index: 90;
    cursor: pointer;
    transition: transform 0.2s;
  }

  .mobile-chat-fab:active {
    transform: scale(0.95);
  }

  .mobile-chat-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 95;
    backdrop-filter: blur(2px);
    animation: fadeBackdrop 0.3s;
  }

  /* Adjust typography for mobile */
  .sheet-header h1 {
    font-size: 1.8rem;
  }

  .title-input {
    font-size: 1.8rem;
  }

  .source-content {
    flex-direction: column;
    gap: 1rem;
  }

  .text-heb {
    order: 1;
    text-align: right;
  }

  .text-eng {
    order: 2;
  }
}

/* Desktop styles for new elements */
@media (min-width: 769px) {

  .mobile-chat-fab,
  .mobile-close-btn,
  .mobile-chat-backdrop {
    display: none !important;
  }
}

@keyframes fadeBackdrop {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

/* Drag and Drop & Export Styles */

.header-actions {
  margin-top: 1rem;
}

.export-btn {
  background-color: var(--primary-color);
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  cursor: pointer;
  font-family: inherit;
  font-size: 0.875rem;
  transition: opacity 0.2s;
}

.google-btn {
  background: #4285F4;
  /* Google Blue */
  margin-right: 0.5rem;
}

.google-btn:disabled {
  background: #a0c3ff;
  cursor: not-allowed;
}

.export-btn:hover {
  background-color: #2563eb;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 0.8rem;
}

.drag-handle {
  touch-action: none;
  cursor: grab;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.2rem;
  border-radius: 4px;
  transition: background 0.2s;
}

.drag-handle:hover {
  background-color: #f3f4f6;
}

.drag-handle:active {
  cursor: grabbing;
}

.source-header h3 {
  margin: 0;
}

.sortable-item {
  /* Allow scrolling on the item itself */
  touch-action: manipulation;
}

.sidebar-logo {
  width: auto;
  max-width: 100%;
  height: 60px;
  /* Fixed height for consistency */
  object-fit: contain;
  display: block;
  margin-bottom: 0.5rem;
  /* box-sizing: border-box; */
}

.version-select {
  padding: 0.3rem;
  border-radius: 4px;
  border: 1px solid #d1d5db;
  font-size: 0.8rem;
  color: #374151;
  background-color: white;
  text-overflow: ellipsis;
}

.version-label {
  display: block;
  margin-top: 0.5rem;
  font-size: 0.75rem;
  color: #9ca3af;
  font-style: italic;
  font-family: var(--font-ui);
}

.loading-text {
  color: #6b7280;
  font-style: italic;
  text-align: center;
  width: 100%;
}

.sheet-footer {
  margin-top: 3rem;
  padding: 2rem;
  text-align: center;
  color: #9ca3af;
  font-size: 0.9rem;
  border-top: 1px solid #e5e7eb;
  width: 100%;
  max-width: 900px;
}

.sheet-footer a {
  color: var(--primary-color);
  text-decoration: none;
}

.sheet-footer a:hover {
  text-decoration: underline;
}

.footer-legal {
  margin-top: 0.5rem;
  font-size: 0.8rem;
}

.version-tag {
  color: #6b7280;
  font-size: 0.75rem;
  opacity: 0.8;
}

/* Title Input & Export Links */
.title-input {
  font-family: var(--font-english-serif);
  font-size: 2.5rem;
  color: var(--sheet-text);
  text-align: center;
  border: none;
  border-bottom: 2px solid transparent;
  background: transparent;
  width: 100%;
  max-width: 900px;
  outline: none;
  padding: 0.5rem;
  transition: border-color 0.2s;
}

.title-input:focus {
  border-bottom-color: var(--primary-color);
}

.export-success-msg {
  margin: 1rem 0;
  padding: 1rem;
  background-color: #ecfdf5;
  border: 1px solid #10b981;
  border-radius: 8px;
  animation: fadeIn 0.5s;
}

.open-doc-link {
  color: #059669;
  font-weight: bold;
  font-size: 1.1rem;
  text-decoration: none;
}

.open-doc-link:hover {
  text-decoration: underline;
}

/* Export Dropdown */
.export-menu-container {
  position: relative;
  display: inline-block;
}

.export-main-btn {
  background-color: var(--primary-color);
  color: white;
  border: none;
  padding: 0.6rem 1.2rem;
  border-radius: 6px;
  cursor: pointer;
  font-family: inherit;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: background-color 0.2s;
}

.export-main-btn:hover {
  background-color: #2563eb;
}

.export-dropdown {
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 0.5rem;
  background-color: white;
  min-width: 180px;
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  border-radius: 6px;
  border: 1px solid #e5e7eb;
  z-index: 50;
  overflow: hidden;
  animation: fadeIn 0.15s ease-out;
}

.export-dropdown button {
  display: block;
  width: 100%;
  padding: 0.75rem 1rem;
  text-align: left;
  background: none;
  border: none;
  color: #374151;
  font-size: 0.9rem;
  cursor: pointer;
  transition: background-color 0.1s;
}

.export-dropdown button:hover {
  background-color: #f3f4f6;
  color: var(--primary-color);
}
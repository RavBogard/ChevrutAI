/* Global Vars & Reset fixes */
:root {
  --primary-color: #3b82f6;
  /* Modern Blue */
  --accent-color: #6366f1;
  /* Indigo */
  --sidebar-bg: #111827;
  /* Dark Slate */
  --sidebar-text: #f3f4f6;
  --sheet-bg: #ffffff;
  --sheet-text: #1f2937;
  --message-user-bg: #3b82f6;
  --message-bot-bg: #1f2937;
  --border-color: #374151;

  --font-ui: 'Inter', system-ui, sans-serif;
  /* Classic Hebrew feel */
  --font-english-serif: 'Merriweather', serif;

  --source-bg: #ffffff;
  --input-bg: #f9fafb;
}

body.dark-mode {
  --sheet-bg: #111827;
  /* Gray 900 */
  --sheet-text: #f3f4f6;
  /* Gray 100 */
  --source-bg: #1f293b;
  /* Gray 800-ish */
  --border-color: #374151;
  --input-bg: #374151;
}

body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  /* App container handles scroll */
  font-family: var(--font-ui);
  transition: background-color 0.3s, color 0.3s;
}

.app-container {
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: var(--sidebar-bg);
  /* Fallback */
  color: var(--sheet-text);
  overflow: hidden;
}

/* Chat Sidebar */
.chat-sidebar {
  width: 30%;
  min-width: 320px;
  max-width: 450px;
  background-color: var(--sidebar-bg);
  color: var(--sidebar-text);
  display: flex;
  flex-direction: column;
  border-right: 1px solid var(--border-color);
  box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
  z-index: 10;
}

.chat-header {
  padding: 1.5rem;
  border-bottom: 1px solid var(--border-color);
  background: rgba(17, 24, 39, 0.95);
  backdrop-filter: blur(10px);
  position: relative;
  /* For absolute positioning of controls */
}

/* Replaces old header-top-row logic */
.header-top-row {
  display: block;
  width: 100%;
}

.header-controls {
  position: absolute;
  top: 1.5rem;
  right: 1.5rem;
  display: flex;
  align-items: center;
  gap: 8px;
  background: rgba(17, 24, 39, 0.5);
  /* Slight bg to ensure visibility over logo if overlap */
  border-radius: 20px;
}

.messages-list {
  flex: 1;
  overflow-y: auto;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  /* Removed justify-content: flex-end to allow top-flow */
}

/* Empty State Prompts */
/* Empty State Prompts */
.empty-prompts-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
  margin: 2rem auto 0 auto;
  /* Center grid */
  width: 100%;
  max-width: 800px;
}

.prompt-card {
  background: white;
  border: 1px solid var(--border-color);
  padding: 1rem 1.5rem;
  border-radius: 12px;
  cursor: pointer;
  text-align: left;
  transition: all 0.2s ease;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
  display: flex;
  align-items: center;
  gap: 0.8rem;
  color: var(--sheet-text);
  font-size: 0.95rem;
}

.initial-theme-toggle {
  position: absolute;
  top: 1.5rem;
  right: 1.5rem;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  /* Subtle bg */
  border: 1px solid var(--border-color);
  color: var(--sheet-text);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 50;
  transition: all 0.2s;
}

.initial-theme-toggle:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: scale(1.05);
}

.prompt-card:hover {
  transform: translateY(-2px);
  border-color: var(--primary-color);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
}

.prompt-icon {
  font-size: 1.2rem;
}

body.dark-mode .prompt-card {
  background: rgba(255, 255, 255, 0.05);
  border-color: var(--border-color);
  color: var(--sheet-text);
}

/* Modern Chat Input */
/* Modern Chat Input */
.chat-input-container {
  padding: 0 1.5rem 2rem 1.5rem;
  /* More bottom buffer */
  background-color: var(--sidebar-bg);
  flex-shrink: 0;
  position: relative;
  z-index: 20;
  margin-top: 1rem;
  /* Separation from messages */
}

.chat-textarea {
  width: 100%;
  min-height: 60px;
  /* Taller */
  max-height: 200px;
  padding: 16px 54px 16px 20px;
  /* More padding */
  border-radius: 24px;
  /* More rounded/modern */
  border: 1px solid var(--border-color);
  background-color: #374151;
  color: white;
  font-family: inherit;
  font-size: 1rem;
  line-height: 1.5;
  resize: none;
  display: block;
  outline: none;
  transition: border-color 0.2s, box-shadow 0.2s, background-color 0.2s;
  overflow-y: hidden;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

/* Show scrollbar if max height reached */
.chat-textarea:not([style*="height: auto"]) {
  overflow-y: auto;
}

.chat-textarea:focus {
  border-color: var(--primary-color);
  background-color: #4b5563;
  /* Slightly lighter on focus? or keep same */
  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3), 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

.chat-textarea::placeholder {
  color: #9ca3af;
  opacity: 0.8;
}

.send-button {
  position: absolute;
  right: 8px;
  bottom: 8px;
  width: 36px;
  height: 36px;
  border-radius: 8px;
  background-color: var(--primary-color);
  color: white;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
}

.send-button:disabled {
  background-color: #4b5563;
  color: #9ca3af;
  cursor: not-allowed;
  opacity: 0.7;
}

.send-button:not(:disabled):hover {
  background-color: #2563eb;
  transform: scale(1.05);
}

/* Theme Toggle Button Update */
.theme-toggle-btn {
  background: transparent;
  border: 1px solid transparent;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: #9ca3af;
  transition: all 0.2s;
}

.theme-toggle-btn:hover {
  background-color: rgba(255, 255, 255, 0.1);
  color: #f3f4f6;
}

body.dark-mode .prompt-card:hover {
  background: rgba(255, 255, 255, 0.08);
  border-color: var(--primary-color);
}

/* Improved Loading Indicator */
.loading-indicator {
  padding: 1rem;
  background-color: var(--message-bot-bg);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  border-bottom-left-radius: 2px;
  align-self: flex-start;
  color: #9ca3af;
  font-size: 0.9rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  animation: fadeIn 0.3s ease;
}

.typing-dots {
  display: flex;
  gap: 4px;
}

.typing-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background-color: #9ca3af;
  animation: typing 1.4s infinite ease-in-out both;
}

.typing-dot:nth-child(1) {
  animation-delay: -0.32s;
}

.typing-dot:nth-child(2) {
  animation-delay: -0.16s;
}

@keyframes typing {

  0%,
  80%,
  100% {
    transform: scale(0);
    opacity: 0.5;
  }

  40% {
    transform: scale(1);
    opacity: 1;
  }
}

/* Sheet View */
.sheet-view {
  flex: 1;
  background-color: var(--sheet-bg);
  color: var(--sheet-text);
  overflow-y: auto;
  padding: 2rem 4rem;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.sheet-header {
  text-align: center;
  margin-bottom: 3rem;
  border-bottom: 2px solid #e5e7eb;
  padding-bottom: 1rem;
  width: 100%;
  max-width: 900px;
}

.sheet-header h1 {
  font-family: var(--font-english-serif);
  font-size: 2.5rem;
  color: #111827;
  margin: 0;
}

.sheet-meta {
  color: #6b7280;
  font-style: italic;
  margin-top: 0.5rem;
}

.sheet-paper {
  width: 100%;
  max-width: 900px;
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.empty-state {
  text-align: center;
  color: #9ca3af;
  margin-top: 4rem;
  font-size: 1.1rem;
}

/* Source Block */
.source-block {
  background: var(--source-bg);
  color: var(--sheet-text);
  /* subtle visual separation if background is not white, but here bg is white. 
     Let's add a left border or subtle shadow for block distinction */
  border-left: 4px solid var(--primary-color);
  padding: 1rem 1.5rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
  border-radius: 0 8px 8px 0;
  transition: all 0.2s;
}

.source-block:hover {
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

.source-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  border-bottom: 1px solid #f3f4f6;
  padding-bottom: 0.5rem;
}

.source-header h3 {
  margin: 0;
  font-family: var(--font-english-serif);
  color: var(--primary-color);
  font-size: 1.2rem;
}

.source-controls {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

.view-toggle {
  padding: 0.3rem;
  border-radius: 4px;
  border: 1px solid var(--border-color);
  font-size: 0.8rem;
  color: var(--sheet-text);
  background-color: var(--source-bg);
}

.remove-btn {
  background: transparent;
  color: #9ca3af;
  border: none;
  font-size: 1.2rem;
  line-height: 1;
  padding: 0 0.4rem;
}

.remove-btn:hover {
  color: #ef4444;
  background: transparent;
}

.source-content {
  display: flex;
  gap: 2rem;
  font-size: 1.1rem;
  line-height: 1.6;
}

.text-eng,
.text-heb {
  flex: 1;
}

.text-eng {
  font-family: var(--font-english-serif);
}

.text-heb {
  font-family: var(--font-hebrew);
  text-align: right;
  font-size: 1.3rem;
  /* Hebrew often needs to be slightly larger */
}

/* View Modes */
.view-english .text-heb {
  display: none;
}

.view-hebrew .text-eng {
  display: none;
}

/* Responsive */
/* Mobile Layout (<768px) */
@media (max-width: 768px) {
  .app-container {
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
  }

  /* Sheet View takes full screen */
  .sheet-view {
    height: 100%;
    width: 100%;
    padding: 1rem;
    overflow-y: auto;
    padding-bottom: 80px;
    /* Space for FAB */
  }

  /* Compact Logo Header for Mobile (Optional: If you want a header on the sheet view on mobile)
     Currently the sidebar is hidden, so we might want a small logo on the SheetView or just rely on the Chat header when opened.
     The user requirement says "Compact header with small logo". 
     Since the sidebar is now hidden, the logo is hidden too. 
     We should probably ensure the Sheet View has some branding or the sidebar header acts as a persistent top bar?
     
     The user said: "Compact header with small logo + hamburger menu" (or similar).
     However, the chat IS the sidebar.
     
     Let's implement the Bottom Sheet Chat approach logic.
  */

  /* Hide sidebar by default on mobile */
  .chat-sidebar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 85vh;
    /* Cover most of height */
    max-height: 85vh;
    background-color: var(--sidebar-bg);
    z-index: 100;
    border-radius: 20px 20px 0 0;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.4);
    transform: translateY(110%);
    /* Hidden */
    transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    border-right: none;
    display: flex;
    /* Override previous styles if needed */
  }

  .chat-sidebar.mobile-open {
    transform: translateY(0);
  }

  /* Chat Header Mobile Adjustments */
  .chat-header {
    padding: 1rem;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }

  .header-top-row {
    display: flex;
    width: 100%;
    justify-content: space-between;
    align-items: center;
  }

  /* Reduce Logo Size significantly */
  .sidebar-logo {
    max-height: 40px !important;
    min-height: 0;
    width: auto;
    padding-right: 0;
    margin-bottom: 0;
  }

  .header-controls {
    position: static;
    background: transparent;
    padding: 0;
  }

  /* Mobile Close Button */
  .mobile-close-btn {
    display: block;
    background: none;
    border: none;
    color: #9ca3af;
    font-size: 2rem;
    cursor: pointer;
    padding: 0 0.5rem;
  }

  .mobile-chat-fab {
    display: flex;
    align-items: center;
    justify-content: center;
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background-color: var(--primary-color);
    color: white;
    border: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    z-index: 90;
    cursor: pointer;
    transition: transform 0.2s;
  }

  .mobile-chat-fab:active {
    transform: scale(0.95);
  }

  .mobile-chat-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 95;
    backdrop-filter: blur(2px);
    animation: fadeBackdrop 0.3s;
  }

  /* Adjust typography for mobile */
  .sheet-header h1 {
    font-size: 1.8rem;
  }

  .title-input {
    font-size: 1.8rem;
  }

  .source-content {
    flex-direction: column;
    gap: 1rem;
  }

  .text-heb {
    order: 1;
    text-align: right;
  }

  .text-eng {
    order: 2;
  }
}

/* Desktop styles for new elements */
@media (min-width: 769px) {

  .mobile-chat-fab,
  .mobile-close-btn,
  .mobile-chat-backdrop {
    display: none !important;
  }
}

@keyframes fadeBackdrop {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

/* Drag and Drop & Export Styles */

.header-actions {
  margin-top: 1rem;
}

.export-btn {
  background-color: var(--primary-color);
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  cursor: pointer;
  font-family: inherit;
  font-size: 0.875rem;
  transition: opacity 0.2s;
}

.google-btn {
  background: #4285F4;
  /* Google Blue */
  margin-right: 0.5rem;
}

.google-btn:disabled {
  background: #a0c3ff;
  cursor: not-allowed;
}

.export-btn:hover {
  background-color: #2563eb;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 0.8rem;
}

.drag-handle {
  touch-action: none;
  cursor: grab;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.2rem;
  border-radius: 4px;
  transition: background 0.2s;
}

.drag-handle:hover {
  background-color: #f3f4f6;
}

.drag-handle:active {
  cursor: grabbing;
}

.source-header h3 {
  margin: 0;
}

.sortable-item {
  /* Allow scrolling on the item itself */
  touch-action: manipulation;
}

.sidebar-logo {
  width: 100%;
  height: auto;
  min-height: 48px;
  /* Prevent collapse */
  object-fit: contain;
  display: block;
  margin-bottom: 0px;
  padding-right: 60px;
  /* Reserve space for controls */
}

.version-select {
  padding: 0.3rem;
  border-radius: 4px;
  border: 1px solid #d1d5db;
  font-size: 0.8rem;
  color: #374151;
  background-color: white;
  text-overflow: ellipsis;
}

.version-label {
  display: block;
  margin-top: 0.5rem;
  font-size: 0.75rem;
  color: #9ca3af;
  font-style: italic;
  font-family: var(--font-ui);
}

.loading-text {
  color: #6b7280;
  font-style: italic;
  text-align: center;
  width: 100%;
}

.sheet-footer {
  margin-top: 3rem;
  padding: 2rem;
  text-align: center;
  color: #9ca3af;
  font-size: 0.9rem;
  border-top: 1px solid #e5e7eb;
  width: 100%;
  max-width: 900px;
}

.sheet-footer a {
  color: var(--primary-color);
  text-decoration: none;
}

.sheet-footer a:hover {
  text-decoration: underline;
}

.footer-legal {
  margin-top: 0.5rem;
  font-size: 0.8rem;
}

.version-tag {
  color: #6b7280;
  font-size: 0.75rem;
  opacity: 0.8;
}

/* Title Input & Export Links */
.title-input {
  font-family: var(--font-english-serif);
  font-size: 2.5rem;
  color: var(--sheet-text);
  text-align: center;
  border: none;
  border-bottom: 2px solid transparent;
  background: transparent;
  width: 100%;
  max-width: 900px;
  outline: none;
  padding: 0.5rem;
  transition: border-color 0.2s;
}

.title-input:focus {
  border-bottom-color: var(--primary-color);
}

.export-success-msg {
  margin: 1rem 0;
  padding: 1rem;
  background-color: #ecfdf5;
  border: 1px solid #10b981;
  border-radius: 8px;
  animation: fadeIn 0.5s;
}

.open-doc-link {
  color: #059669;
  font-weight: bold;
  font-size: 1.1rem;
  text-decoration: none;
}

.open-doc-link:hover {
  text-decoration: underline;
}

/* Central Input (SheetView Empty State) */
.central-hero {
  text-align: center;
  margin-bottom: 2rem;
  width: 100%;
  max-width: 700px;
  margin: 0 auto 3rem auto;
}

.central-hero h2 {
  font-size: 2rem;
  margin-bottom: 0.5rem;
  color: var(--sheet-text);
}

.central-hero p {
  color: #6b7280;
  margin-bottom: 2rem;
}

.central-input-wrapper {
  position: relative;
  width: 100%;
}

.central-textarea {
  width: 100%;
  min-height: 56px;
  padding: 16px 60px 16px 20px;
  border-radius: 28px;
  border: 1px solid var(--border-color);
  background-color: var(--input-bg);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  font-family: inherit;
  font-size: 1.1rem;
  resize: none;
  overflow-y: hidden;
  outline: none;
  transition: all 0.2s;
  color: var(--sheet-text);
  line-height: 1.5;
}

body.dark-mode .central-textarea {
  background-color: #374151;
  border-color: #4b5563;
  color: white;
}

.central-textarea:focus {
  box-shadow: 0 8px 20px rgba(59, 130, 246, 0.15);
  border-color: var(--primary-color);
}

.central-send-btn {
  position: absolute;
  right: 8px;
  top: 8px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background-color: var(--primary-color);
  color: white;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: transform 0.2s;
}

.central-send-btn:disabled {
  background-color: #9ca3af;
  opacity: 0.7;
  cursor: not-allowed;
}

.central-send-btn:not(:disabled):hover {
  transform: scale(1.05);
  background-color: #2563eb;
}

/* Export Dropdown */
.export-menu-container {
  position: relative;
  display: inline-block;
}

.export-main-btn {
  background-color: var(--primary-color);
  color: white;
  border: none;
  padding: 0.6rem 1.2rem;
  border-radius: 6px;
  cursor: pointer;
  font-family: inherit;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: background-color 0.2s;
}

.export-main-btn:hover {
  background-color: #2563eb;
}

.export-dropdown {
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 0.5rem;
  background-color: white;
  min-width: 180px;
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  border-radius: 6px;
  border: 1px solid #e5e7eb;
  z-index: 50;
  overflow: hidden;
  animation: fadeIn 0.15s ease-out;
}

.export-dropdown button {
  display: block;
  width: 100%;
  padding: 0.75rem 1rem;
  text-align: left;
  background: none;
  border: none;
  color: #374151;
  font-size: 0.9rem;
  cursor: pointer;
  transition: background-color 0.1s;
}

.export-dropdown button:hover {
  background-color: #f3f4f6;
  color: var(--primary-color);
}